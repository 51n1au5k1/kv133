# Настройки хранения инфы в БД
db_url: !secret db_link # Формат: mysql://user:pass@IP/db_name?charset=utf8mb4
db_max_retries: 20 # Увеличено для MariaDB
db_retry_wait: 5 # Увеличено для MariaDB
auto_purge: false
purge_keep_days: 90
auto_repack: false # Для MariaDB лучше управлять вручную
commit_interval: 30 # Снижает нагрузку на диск

# --- Сначала определяем, что мы хотим хранить в целом ---
include:
  # Включаем целые домены сущностей
  domains:
    - light
    - switch
    - binary_sensor
    - input_boolean
    - select
    - climate
    - timer
    - weather
    - media_player
    - automation
    - event

  # Включаем группы сущностей по маске имени
  entity_globs:
    - sensor.*temperature*
    - sensor.*humidity*
    - sensor.*_battery*
    - sensor.*_pressure
    - sensor.*_co2
    - sensor.*_pm25
    - binary_sensor.*_contact
    - binary_sensor.*_occupancy
    - sensor.cpu_*_normalized
    - sensor.cpu_*_host_percent
    - sensor.*_energy
    - sensor.*_power
    # Цветы
    - sensor.ficus_*
    - sensor.euphorbia_*
    - plant.*
    # Виртуализация
    - sensor.lxc_*
    - sensor.qemu_*
    - sensor.*_pve_*
    # Скорость интернета
    - sensor.speedtest_*
    # Фильтры климатическойц техники
    - sensor.*_filter_*
    # Контроль уровня воды
    - event.*_low_water_*
    # Сейф
    - sensor.strongbox_*
    # Эксперементальные
    - sensor.vremia_igry_*
    - sensor.*_ps5_*

  # Включаем отдельные сущности, которые не попали в правила выше (ТОЛЬКО точные ID)
  entities:
    # Системные и специфические сенсоры
    - sensor.maria_db_size
    # Климатические кастомные (точные имена)
    - sensor.uroven_co2_sglazhennyi
    - sensor.bathroom_filtered_humidity
    - sensor.temperatura_v_gostinnoi_sglazhennaia
    - sensor.temperatura_v_spalne_sglazhennaia
    - sensor.srednee_znachenie_temperatury_v_masterskoi_2
    # Электроэнергия
    - sensor.potreblenie_stiralnoi_mashiny
    # Кто был дома
    - input_text.currently_home
    # Тестовая секция (точный сенсор)
    - sensor.app_usage_last_month

# --- Теперь определяем, что мы ТОЧНО НЕ хотим хранить ---
exclude:
  # Исключаем "шумные" домены
  domains:
    - update
    - camera
    - button
    - script
    - vacuum

  # Исключаем "шумные" группы сущностей
  entity_globs:
    - sensor.*_linkquality # Очень частые апдейты
    - sensor.*_power_* # Часто "шумные"
    - binary_sensor.*_battery_low # Дублирует информацию про батарею

  # Исключаем отдельные "шумные" сущности
  entities:
    - binary_sensor.backups_stale # Если он не важен для истории

  # Системные типы событий (для истории не нужны)
  event_types:
    - call_service
    - automation_triggered
    - logbook_entry
    - service_registered
# Ссылка на сервер MariaDB в секретах по шаблону:
# db_link: mysql://user:pass@IP/homeassistant?charset=utf8mb4&ssl=true
