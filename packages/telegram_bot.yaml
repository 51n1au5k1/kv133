# packages/telegram_bot.yaml
# ====================================================================
# –ü–∞–∫–µ—Ç: Telegram Bot –¥–ª—è Home Assistant
# ====================================================================
# –≠—Ç–æ—Ç –ø–∞–∫–µ—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–º–Ω—ã–º –¥–æ–º–æ–º —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞.
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç—É –∏ –ø–æ–ª—É—á–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π
# —Å—Ç–∞—Ç—É—Å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –∫–æ–º–Ω–∞—Ç.
#
# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤–∫–ª—é—á–∞–µ—Ç:
# - –í—ã–≤–æ–¥ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–º–µ—â–µ–Ω–∏–π (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –≤–ª–∞–∂–Ω–æ—Å—Ç—å, CO‚ÇÇ –∏ —Ç. –¥.).
# - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ–º, —Ä–æ–∑–µ—Ç–∫–∞–º–∏, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–µ–π –∏ –¥—Ä—É–≥–∏–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.
# - –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Å–µ—Ç–∏ (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –ø–∏–Ω–≥, —Å–∫–æ—Ä–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞).
# - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ Home Assistant –∏–∑ Telegram.
#
# ====================================================================
# –ü–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∫—Ä–∏–ø—Ç—ã?
# ====================================================================
# –í –ø–∞–∫–µ—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å
# —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
# - –ò–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è—Ö.
# - –£–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ: –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è,
#   –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–∫—Ä–∏–ø—Ç.
# - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Telegram –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π.
#
# –ü—Ä–∏–º–µ—Ä:
# –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤ –∫–∞–∂–¥–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–Ω–æ–≤–æ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å
# —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –º—ã —Å–æ–∑–¥–∞–µ–º –æ–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `send_livingroom_status`),
# –∞ –∑–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ–º –µ–≥–æ –≤–æ –≤—Å–µ—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è—Ö.
#
# ====================================================================
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–∞:
# ====================================================================
# script:
#   - –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ Telegram.
#
# automation:
#   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫.
#   - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤.
#
# ====================================================================
# –†–∞–∑–¥–µ–ª—ã –º–µ–Ω—é Telegram:
# ====================================================================
# /main_menu       - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
# /livingroom_control - –ì–æ—Å—Ç–∏–Ω–∞—è
# /kitchen_control  - –ö—É—Ö–Ω—è
# /workroom_control - –†–∞–±–æ—á–∏–π –∫–∞–±–∏–Ω–µ—Ç
# /bedroom_control - –°–ø–∞–ª—å–Ω—è
# /bathroom_control   - –í–∞–Ω–Ω–∞—è
# /hallway_control - –ü—Ä–∏—Ö–æ–∂–∞—è
# /system_control  - –°–∏—Å—Ç–µ–º–∞ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Å–µ—Ç–∏)
# /pve_status_refresh - –°–∏—Å—Ç–µ–º–∞ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ Proxmox Virtual Environment
#
# ====================================================================
# –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
# ====================================================================
# - –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ Telegram —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è —É–¥–∞–ª–µ–Ω–∏–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ
#   —Å–æ–æ–±—â–µ–Ω–∏—è, —á—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Å—Ç–∞–≤–∞–ª—Å—è —á–∏—Å—Ç—ã–º –∏ —É–¥–æ–±–Ω—ã–º.
# - –í –æ—Ç–≤–µ—Ç–∞—Ö –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å", —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å
#   –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤.
# - –í —Å–ª—É—á–∞–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (—Å–≤–µ—Ç, —Ä–æ–∑–µ—Ç–∫–∏)
#   –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π
#   —Å—Ç–∞—Ç—É—Å.
#
# ====================================================================
# –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:
# ====================================================================
# - –ó–∞–ø—É—Å–∫–∞–µ—Ç `homeassistant.restart`, –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—è HA.
# - –ü–µ—Ä–µ–¥ —ç—Ç–∏–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
# - –í–∫–ª—é—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
#
# –î–æ—Ä–∞–±–æ—Ç–∫–∏:
# - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ unavailable states (default 'N/A').
# - –û–±—â–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è toggle (toggle_device —Å params).
# - Confirmation –¥–ª—è reboot (–Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ /confirm_reboot).
# - silent_mode/startup_phase –≤ triggers.
# - Input_number –¥–ª—è delay, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π.
#
# ====================================================================

input_number:
  telegram_delay_ms:
    name: "–ó–∞–¥–µ—Ä–∂–∫–∞ –≤ Telegram-–±–æ—Ç–µ (ms)"
    min: 100
    max: 1000
    step: 50
    initial: 200
    icon: mdi:timer-sand

input_boolean:
  telegram_bot_log_commands:
    name: "–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã Telegram"
    initial: true
    icon: mdi:math-log

# –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ Telegram

script:
  toggle_device:
    alias: "–û–±—â–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è toggle —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ–Ω—é"
    fields:
      entity:
        description: "Entity ID –¥–ª—è toggle"
        required: true
      domain:
        description: "Domain (light/switch/fan)"
        required: true
      menu_script:
        description: "–°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ –º–µ–Ω—é"
        required: true
      message_id:
        description: "ID —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è"
        required: true
      chat_id:
        description: "ID —á–∞—Ç–∞"
        required: true
      user_id:
        description: "ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
        required: false
    sequence:
      - service: >-
          {% if domain == 'climate' %}
            climate.turn_{{ 'on' if is_state(entity, 'off') else 'off' }}
          {% else %}
            {{ domain }}.toggle
          {% endif %}
        target:
          entity_id: "{{ entity }}"
      - service: telegram_bot.delete_message
        data:
          message_id: "{{ message_id }}"
          chat_id: "{{ chat_id }}"
      - service: "{{ menu_script }}"
        data:
          target: "{{ chat_id }}"
      - service: system_log.write
        data:
          message: "Toggle {{ entity }} —á–µ—Ä–µ–∑ Telegram (user: {{ user_id | default('unknown') }})"
          level: info

  send_main_menu:
    alias: "Send Main Menu"
    sequence:
      - service: telegram_bot.send_message
        data:
          target: "{{ target }}"
          parse_mode: html
          message: |
            <b>üíª –í—ã–±—Ä–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è :</b>
          inline_keyboard: >
            {{ [
                [ ["üè† –ì–æ—Å—Ç–∏–Ω–∞—è", "/livingroom_control"], ["üçΩ –ö—É—Ö–Ω—è", "/kitchen_control"] ],
                [ ["üè¢ –†–∞–±–æ—á–∏–π –∫–∞–±–∏–Ω–µ—Ç", "/workroom_control"], ["üõè –°–ø–∞–ª—å–Ω—è", "/bedroom_control"] ],
                [ ["üõÅ –í–∞–Ω–Ω–∞—è", "/bathroom_control"], ["üö™ –ö–æ—Ä–∏–¥–æ—Ä", "/hallway_control"] ],
                [ ["üñ• –°–∏—Å—Ç–µ–º–∞", "/system_control"] ]
              ] | tojson }}

  send_livingroom_status:
    alias: "Send Living Room Status"
    sequence:
      - service: telegram_bot.send_message
        data:
          target: "{{ target }}"
          parse_mode: html
          message: |
            <b>üè† –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –≥–æ—Å—Ç–∏–Ω–æ–π:</b>
            üå° <b>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</b> {{ states('sensor.livingroom_climat_sensor_temperature') | default('N/A') }}¬∞C
            üíß <b>–í–ª–∞–∂–Ω–æ—Å—Ç—å:</b> {{ states('sensor.livingroom_climat_sensor_humidity') | default('N/A') }}%
            üåø <b>CO‚ÇÇ:</b> {{ states('sensor.co2_monitor_co2') | default('N/A') }} ppm
            üí® <b>PM2.5:</b> {{ states('sensor.zhimi_cn_271517251_mb3_pm2_5_density_p_3_6') | default('N/A') }} ¬µg/m¬≥
            üö™ <b>–°—Ç–∞—Ç—É—Å –¥–≤–µ—Ä–µ–π:</b> {% if is_state('binary_sensor.gostinaia_balkon_contact','on') or is_state('binary_sensor.0x00158d0003ce9922_contact','on') %}–û—Ç–∫—Ä—ã—Ç–∞{% else %}–ó–∞–∫—Ä—ã—Ç–∞{% endif %}
          inline_keyboard: >
            {{ [
                [ ["üî¥ –õ—é—Å—Ç—Ä–∞" if is_state("light.livingroom_main_switch_left", "off") else "üü¢ –õ—é—Å—Ç—Ä–∞", "/toggle_livingroom_main_switch_left"],
                  ["üî¥ –°–≤–µ—Ç –Ω–∞–¥ –¥–∏–≤–∞–Ω–æ–º" if is_state("light.livingroom_main_switch_right", "off") else "üü¢ –°–≤–µ—Ç –Ω–∞–¥ –¥–∏–≤–∞–Ω–æ–º", "/toggle_livingroom_main_switch_right"],
                  ["üî¥ –ë—Ä–∞" if is_state("light.livingroom_scone_dimmer", "off") else "üü¢ –ë—Ä–∞", "/toggle_livingroom_scone_dimmer"] ],
                [ ["üî¥ –ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä" if is_state("climate.konditsioner", "off") else "üü¢ –ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä", "/toggle_livingroom_konditsioner"],
                  ["üî¥ –û—á–∏—Å—Ç–∏—Ç–µ–ª—å" if is_state("fan.zhimi_cn_271517251_mb3_s_2_air_purifier", "off") else "üü¢ –û—á–∏—Å—Ç–∏—Ç–µ–ª—å", "/toggle_livingroom_air_purifier"],
                  ["üî¥ –£–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å" if is_state("humidifier.xiaomi_cn_823407205_p3", "off") else "üü¢ –£–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å", "/toggle_livingroom_humidifier"] ],
                [ ["üî¥ –£–≥–ª–æ–≤–∞—è —Ä–æ–∑–µ—Ç–∫–∞" if is_state("switch.livingroom_socket_corner_r", "off") else "üü¢ –£–≥–ª–æ–≤–∞—è —Ä–æ–∑–µ—Ç–∫–∞", "/toggle_livingroom_socket_corner_r"],
                  ["üî¥ –õ–µ–≤–∞—è —Ä–æ–∑–µ—Ç–∫–∞" if is_state("switch.livingroom_socket_l", "off") else "üü¢ –õ–µ–≤–∞—è —Ä–æ–∑–µ—Ç–∫–∞", "/toggle_livingroom_socket_l"],
                  ["üî¥ –ü—Ä–∞–≤–∞—è —Ä–æ–∑–µ—Ç–∫–∞" if is_state("switch.livingroom_socket_r", "off") else "üü¢ –ü—Ä–∞–≤–∞—è —Ä–æ–∑–µ—Ç–∫–∞", "/toggle_livingroom_socket_r"] ],
                [ ["üëà –í –º–µ–Ω—é", "/menu_back"], ["‚Üª –û–±–Ω–æ–≤–∏—Ç—å", "/livingroom_control"] ]
              ] | tojson }}

  send_workroom_status:
    alias: "Send Workroom Status"
    sequence:
      - service: telegram_bot.send_message
        data:
          target: "{{ target }}"
          parse_mode: html
          message: |
            <b>üè¢ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Ä–∞–±–æ—á–µ–º –∫–∞–±–∏–Ω–µ—Ç–µ:</b>
            <b>üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</b> {{ states('sensor.cgllc_cn_blt_3_15gd8656slo00_dove_temperature_p_2_1') | default('N/A') }}¬∞C
            <b>üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å:</b> {{ states('sensor.cgllc_cn_blt_3_15gd8656slo00_dove_relative_humidity_p_2_2') | default('N/A') }}%
            <b>üö™ –°—Ç–∞—Ç—É—Å –¥–≤–µ—Ä–∏:</b> {% if is_state('binary_sensor.masterskaia_balkon_contact', 'on') %}–û—Ç–∫—Ä—ã—Ç–∞{% else %}–ó–∞–∫—Ä—ã—Ç–∞{% endif %}
          inline_keyboard: >
            {{ [
                [ ["üî¥ –û—Å–Ω–æ–≤–Ω–æ–π —Å–≤–µ—Ç" if is_state("light.workroom_switch", "off") else "üü¢ –û—Å–Ω–æ–≤–Ω–æ–π —Å–≤–µ—Ç", "/toggle_workroom_light"],
                  ["üî¥ –ü–æ–¥—Å–≤–µ—Ç–∫–∞" if is_state("light.working_room_led", "off") else "üü¢ –ü–æ–¥—Å–≤–µ—Ç–∫–∞", "/toggle_workroom_led"] ],
                [ ["üî¥ –†–æ–∑–µ—Ç–∫–∞ –æ—Ç–ø–∞—Ä–∏–≤–∞—Ç–µ–ª—è" if is_state("switch.smart_plug_in_unit_vykliuchatel", "off") else "üü¢ –†–æ–∑–µ—Ç–∫–∞ –æ—Ç–ø–∞—Ä–∏–≤–∞—Ç–µ–ª—è", "/toggle_workroom_plug"] ],
                [ ["üëà –í –º–µ–Ω—é", "/menu_back"], ["‚Üª –û–±–Ω–æ–≤–∏—Ç—å", "/workroom_control"] ]
              ] | tojson }}

  send_bedroom_status:
    alias: "Send Bedroom Status"
    sequence:
      - service: telegram_bot.send_message
        data:
          target: "{{ target }}"
          parse_mode: html
          message: |
            <b>üõè –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Å–ø–∞–ª—å–Ω–µ:</b>
            <b>üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</b> {{ states('sensor.bedroom_th_sensor_temperature') | default('N/A') }}¬∞C
            <b>üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å:</b> {{ states('sensor.bedroom_th_sensor_humidity') | default('N/A') }}%
            <b>üö™ –°—Ç–∞—Ç—É—Å –¥–≤–µ—Ä–∏:</b> {% if is_state('binary_sensor.0x00158d00044d5d11_contact', 'on') %}–û—Ç–∫—Ä—ã—Ç–∞{% else %}–ó–∞–∫—Ä—ã—Ç–∞{% endif %}
          inline_keyboard: >
            {{ [
                [ ["üî¥ –û—Å–Ω–æ–≤–Ω–æ–π —Å–≤–µ—Ç" if is_state("light.bedroom_switch_main", "off") else "üü¢ –û—Å–Ω–æ–≤–Ω–æ–π —Å–≤–µ—Ç", "/toggle_bedroom_light"] ],
                [ ["üî¥ –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫ –°–ª–µ–≤–∞" if is_state("light.bedroom_left_switch_right", "off") else "üü¢ –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫ –°–ª–µ–≤–∞", "/toggle_bedroom_scone_t"] ],
                [ ["üî¥ –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫ –°–ø—Ä–∞–≤–∞ –º–∞–ª—ã–π" if is_state("light.bedroom_right_switch_left", "off") else "üü¢ –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫ –°–ø—Ä–∞–≤–∞ –º–∞–ª—ã–π", "/toggle_bedroom_scone_a_small"],
                  ["üî¥ –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫ –°–ø—Ä–∞–≤–∞ –±–æ–ª—å—à–æ–π" if is_state("light.bedroom_right_switch_right", "off") else "üü¢ –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫ –°–ø—Ä–∞–≤–∞ –±–æ–ª—å—à–æ–π", "/toggle_bedroom_scone_a_big"] ],
                [ ["üî¥ –†–æ–∑–µ—Ç–∫–∞ –°–ª–µ–≤–∞" if is_state("switch.0x00158d0002530bd9", "off") else "üü¢ –†–æ–∑–µ—Ç–∫–∞ –°–ª–µ–≤–∞", "/toggle_bedroom_plug_left"],
                  ["üî¥ –†–æ–∑–µ—Ç–∫–∞ –°–ø—Ä–∞–≤–∞" if is_state("switch.0x00158d0002530ba3", "off") else "üü¢ –†–æ–∑–µ—Ç–∫–∞ –°–ø—Ä–∞–≤–∞", "/toggle_bedroom_plug_right"] ],
                [ ["üëà –í –º–µ–Ω—é", "/menu_back"], ["‚Üª –û–±–Ω–æ–≤–∏—Ç—å", "/bedroom_control"] ]
              ] | tojson }}

  send_bathroom_status:
    alias: "Send Bathroom Status"
    sequence:
      - service: telegram_bot.send_message
        data:
          target: "{{ target }}"
          parse_mode: html
          message: |
            <b>üõÅ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –≤–∞–Ω–Ω–æ–π:</b>
            <b>üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</b> {{ states('sensor.bathroom_th_2_temperature') | default('N/A') }}¬∞C
            <b>üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å:</b> {{ states('sensor.bathroom_th_2_humidity') | default('N/A') }}%
            <b>üö™ –°—Ç–∞—Ç—É—Å –¥–≤–µ—Ä–∏:</b> {% if is_state('binary_sensor.bathroom_open_door', 'on') %}–û—Ç–∫—Ä—ã—Ç–∞{% else %}–ó–∞–∫—Ä—ã—Ç–∞{% endif %}
            <b>üß∫ –°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞:</b> {% if is_state('binary_sensor.washing_machine_active', 'on') %}üü¢ –†–∞–±–æ—Ç–∞–µ—Ç{% else %}üî¥ –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç{% endif %}
          inline_keyboard: >
            {{ [
                [ ["üî¥ –í–µ—Å—å —Å–≤–µ—Ç" if is_state("light.light_bathroom", "off") else "üü¢ –í–µ—Å—å —Å–≤–µ—Ç", "/toggle_bathroom_light"] ],
                [ ["üî¥ –í—ã—Ç—è–∂–∫–∞" if is_state("fan.bathroom_relay_l1", "off") else "üü¢ –í—ã—Ç—è–∂–∫–∞", "/toggle_bathroom_fan"] ],
                [ ["üëà –í –º–µ–Ω—é", "/menu_back"], ["‚Üª –û–±–Ω–æ–≤–∏—Ç—å", "/bathroom_control"] ]
              ] | tojson }}

  send_kitchen_status:
    alias: "Send Kitchen Status"
    sequence:
      - service: telegram_bot.send_message
        data:
          target: "{{ target }}"
          parse_mode: html
          message: |
            <b>üçΩ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –∫—É—Ö–Ω–µ:</b>
            <b>üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</b> {{ states('sensor.kitchen_th_temperature') | default('N/A') }}¬∞C
            <b>üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å:</b> {{ states('sensor.kitchen_th_humidity') | default('N/A') }}%
            <b>üö™ –°—Ç–∞—Ç—É—Å –¥–≤–µ—Ä–∏:</b> {% if is_state('binary_sensor.0x00158d0003ce9922_contact', 'on') %}–û—Ç–∫—Ä—ã—Ç–∞{% else %}–ó–∞–∫—Ä—ã—Ç–∞{% endif %}
          inline_keyboard: >
            {{ [
                [ ["üî¥ –û—Å–Ω–æ–≤–Ω–æ–π" if is_state("light.kitchen_main_light", "off") else "üü¢ –û—Å–Ω–æ–≤–Ω–æ–π", "/toggle_kitchen_main_light"],
                  ["üî¥ –ü–æ–¥—Å–≤–µ—Ç–∫–∞" if is_state("switch.kitchen_fartuh", "off") else "üü¢ –ü–æ–¥—Å–≤–µ—Ç–∫–∞", "/toggle_kitchen_fartuh"] ],
                [ ["üëà –í –º–µ–Ω—é", "/menu_back"], ["‚Üª –û–±–Ω–æ–≤–∏—Ç—å", "/kitchen_control"] ]
              ] | tojson }}

  send_hallway_status:
    alias: "Send Hallway Status"
    sequence:
      - service: telegram_bot.send_message
        data:
          target: "{{ target }}"
          parse_mode: html
          message: |
            <b>üö™ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ø—Ä–∏—Ö–æ–∂–µ–π:</b>
            <b>üö™ –°—Ç–∞—Ç—É—Å –¥–≤–µ—Ä–∏:</b> {% if is_state('binary_sensor.hallway_door_contact', 'on') %}–û—Ç–∫—Ä—ã—Ç–∞{% else %}–ó–∞–∫—Ä—ã—Ç–∞{% endif %}
          inline_keyboard: >
            {{ [
                [ ["üî¥ –°–≤–µ—Ç" if is_state("light.hallway_switch", "off") else "üü¢ –°–≤–µ—Ç", "/toggle_hallway_light"],
                  ["üî¥ –®–ª—é–∑" if is_state("light.gateway_light_04cf8c977cdd", "off") else "üü¢ –®–ª—é–∑", "/toggle_hallway_gateway_light"] ],
                [ ["üëà –í –º–µ–Ω—é", "/menu_back"], ["‚Üª –û–±–Ω–æ–≤–∏—Ç—å", "/hallway_control"] ]
              ] | tojson }}

  send_system_status:
    alias: "Send System Status"
    sequence:
      - service: telegram_bot.send_message
        data:
          target: "{{ target }}"
          parse_mode: html
          message: |
            <b>üñ• –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:</b>
            <b>üå° –ö–ª–∏–º–∞—Ç –æ–∫–æ–ª–æ —Å–µ—Ä–≤–µ—Ä–∞:</b>
            <b>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</b> {{ states('sensor.0xa4c13861a18df7c8_temperature') | default('N/A') }}¬∞C
            <b>üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å:</b> {{ states('sensor.0xa4c13861a18df7c8_humidity') | default('N/A') }}%

            <b>üåç –°–∫–æ—Ä–æ—Å—Ç—å —Å–µ—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç:</b>
            <b>üì° –ü–∏–Ω–≥:</b> {{ states('sensor.speedtest_ping') | default('N/A') }} ms
            <b>‚¨áÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞:</b> {{ states('sensor.speedtest_download') | default('N/A') }} Mbps
            <b>‚¨ÜÔ∏è –ü–µ—Ä–µ–¥–∞—á–∞:</b> {{ states('sensor.speedtest_upload') | default('N/A') }} Mbps
          inline_keyboard: >
            {{ [
                [ ["üî¥ –†–æ—É—Ç–µ—Ä" if is_state("switch.my_multi_outlet_left", "off") else "üü¢ –†–æ—É—Ç–µ—Ä", "/toggle_router_socket"],
                  ["üî¥ –ú–∏–Ω–∏–ü–ö" if is_state("switch.my_multi_outlet_right", "off") else "üü¢ –ú–∏–Ω–∏–ü–ö", "/toggle_minipc_socket"] ],
                [ ["üî¥ –ü–∏—Ç–∞–Ω–∏–µ –≤–∞–Ω–Ω–æ–π" if is_state("light.bathroom_main", "off") else "üü¢ –ü–∏—Ç–∞–Ω–∏–µ –≤–∞–Ω–Ω–æ–π", "/toggle_bathroom_power"] ],
                [ ["üî¥ –†–µ–∂–∏–º —Ç–∏—à–∏–Ω—ã" if is_state("input_boolean.silent_mode", "off") else "üü¢ –†–µ–∂–∏–º —Ç–∏—à–∏–Ω—ã", "/toggle_silent_mode"] ],
                [ ["üî¥ –†–µ–∂–∏–º Force CCTV Off" if is_state("input_boolean.force_camera_off", "off") else "üü¢ –†–µ–∂–∏–º Force CCTV Off", "/toggle_force_cctv_mode"] ],
                [ ["‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏", "/pve_status_refresh"] ],
                [ ["‚ö†Ô∏è –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∏—Å—Ç–µ–º—É", "/confirm_reboot"] ],
                [ ["üëà –í –º–µ–Ω—é", "/menu_back"], ["‚Üª –û–±–Ω–æ–≤–∏—Ç—å", "/system_control"] ]
              ] | tojson }}

  send_pve_status:
    alias: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å PVE"
    sequence:
      - service: telegram_bot.send_message
        data:
          target: "{{ target }}"
          parse_mode: html
          message: |
            <b>üñ• –°—Ç–∞—Ç—É—Å –Ω–æ–¥ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</b>

            <b>üìä –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –í–ú:</b> {{ states('sensor.node_pve_virtual_machines_running') | default('N/A') }}
            <b>üìä –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:</b> {{ states('sensor.node_pve_containers_running') | default('N/A') }}

            <b>üî• –ù–∞–≥—Ä—É–∑–∫–∞ CPU:</b>
            <b>VM HAOS12:</b> {{ states('sensor.qemu_haos12_3_100_cpu_used_normalized') | float(0) | round(0) }}% | {{ states('sensor.qemu_haos12_3_100_cpu_used') | float(0) | round(0) }}%
            <b>LXC MariaDB:</b> {{ states('sensor.lxc_mariadb_101_cpu_used_normalized') | float(0) | round(0) }}% | {{ states('sensor.lxc_mariadb_101_cpu_used') | float(0) | round(0) }}%
            <b>LXC Jackett:</b> {{ states('sensor.lxc_jackett_102_cpu_used_normalized') | float(0) | round(0) }}% | {{ states('sensor.lxc_jackett_102_cpu_used') | float(0) | round(0) }}%
            <b>LXC Jellyfin:</b> {{ states('sensor.lxc_jellyfin_103_cpu_used_normalized') | float(0) | round(0) }}% | {{ states('sensor.lxc_jellyfin_103_cpu_used') | float(0) | round(0) }}%
            <b>LXC Deluge:</b> {{ states('sensor.lxc_deluge_104_cpu_used_normalized') | float(0) | round(0) }}% | {{ states('sensor.lxc_deluge_104_cpu_used') | float(0) | round(0) }}%
            <b>LXC TorrServer:</b> {{ states('sensor.lxc_debian_105_cpu_used_normalized') | float(0) | round(0) }}% | {{ states('sensor.lxc_debian_105_cpu_used') | float(0) | round(0) }}%
            <b>LXC Minim Server:</b> {{ states('sensor.lxc_minim_107_cpu_used_normalized') | float(0) | round(0) }}% | {{ states('sensor.lxc_minim_107_cpu_used') | float(0) | round(0) }}%

          inline_keyboard: >
            {{ [
                [ ["üîÑ –û–±–Ω–æ–≤–∏—Ç—å", "/pve_status_refresh"] ],
                [ ["üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å HAOS12", "/reboot_haos12"] ],
                [ ["üü¢ MariaDB", "/start_mariadb"], ["üî¥ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å", "/stop_mariadb"], ["üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞", "/reboot_mariadb"] ],
                [ ["üü¢ Jackett", "/start_jackett"], ["üî¥ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å", "/stop_jackett"], ["üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞", "/reboot_jackett"] ],
                [ ["üü¢ Jellyfin", "/start_jellyfin"], ["üî¥ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å", "/stop_jellyfin"], ["üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞", "/reboot_jellyfin"] ],
                [ ["üü¢ Deluge", "/start_deluge"], ["üî¥ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å", "/stop_deluge"], ["üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞", "/reboot_deluge"] ],
                [ ["üü¢ TorrServer", "/start_torrserver"], ["üî¥ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å", "/stop_torrserver"], ["üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞", "/reboot_torrserver"] ],
                [ ["üü¢ MinimServer", "/start_minimserver"], ["üî¥ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å", "/stop_minimserver"], ["üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞", "/reboot_minimserver"] ],
                [ ["üëà –í –º–µ–Ω—é", "/menu_back"] ]
              ] | tojson }}

  pve_action:
    alias: "PVE Action with Delay"
    fields:
      button: { required: true }
      chat_id: { required: true }
    sequence:
      - service: button.press
        target:
          entity_id: "{{ button }}"
      - delay:
          seconds: 5
      - service: script.send_pve_status
        data:
          target: "{{ chat_id }}"

automation:
  # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–ø—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–º–∞–Ω–¥—ã /start)
  - id: "telegram_bot_start"
    alias: "Telegram Bot Start (–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ)"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_command
        event_data:
          command: "/start"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.send_message
        data:
          target: "{{ trigger.event.data.chat_id }}"
          parse_mode: html
          message: "<b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —É–º–Ω—ã–π –¥–æ–º!</b>"
      - service: script.send_main_menu
        data:
          target: "{{ trigger.event.data.chat_id }}"
      - service: system_log.write
        data:
          message: "Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω (user: {{ trigger.event.data.user_id }})"
          level: info

  ##############################################################################
  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–µ–Ω—é
  ##############################################################################
  # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–ø—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–º–∞–Ω–¥—ã /main_menu)
  - id: "telegram_bot_main_menu"
    alias: "Telegram Bot Main Menu"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_command
        event_data:
          command: "/main_menu"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.send_main_menu
        data:
          target: "{{ trigger.event.data.chat_id }}"

  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–í –º–µ–Ω—é"
  - id: "telegram_bot_menu_back"
    alias: "Telegram Bot Menu Back"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/menu_back"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.delete_message
        data:
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
      - service: script.send_main_menu
        data:
          target: "{{ trigger.event.data.chat_id }}"

  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω—é "–ì–æ—Å—Ç–∏–Ω–∞—è"
  - id: "telegram_bot_livingroom_control"
    alias: "Telegram Bot Living Room Menu"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/livingroom_control"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.delete_message
        data:
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
      - service: script.send_livingroom_status
        data:
          target: "{{ trigger.event.data.chat_id }}"

  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω—é "–†–∞–±–æ—á–∏–π –∫–∞–±–∏–Ω–µ—Ç"
  - id: "telegram_bot_workroom_control"
    alias: "Telegram Bot Workroom Menu"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/workroom_control"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.delete_message
        data:
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
      - service: script.send_workroom_status
        data:
          target: "{{ trigger.event.data.chat_id }}"

  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω—é "–°–ø–∞–ª—å–Ω—è"
  - id: "telegram_bot_bedroom_control"
    alias: "Telegram Bot Bedroom Menu"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/bedroom_control"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.delete_message
        data:
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
      - service: script.send_bedroom_status
        data:
          target: "{{ trigger.event.data.chat_id }}"

  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω—é "–ö—É—Ö–Ω—è"
  - id: "telegram_bot_kitchen_control"
    alias: "Telegram Bot Kitchen Menu"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/kitchen_control"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.delete_message
        data:
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
      - service: script.send_kitchen_status
        data:
          target: "{{ trigger.event.data.chat_id }}"

  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω—é "–í–∞–Ω–Ω–∞—è"
  - id: "telegram_bot_bathroom_control"
    alias: "Telegram Bot Bathroom Menu"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/bathroom_control"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.delete_message
        data:
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
      - service: script.send_bathroom_status
        data:
          target: "{{ trigger.event.data.chat_id }}"

  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω—é "–ü—Ä–∏—Ö–æ–∂–∞—è"
  - id: "telegram_bot_hallway_control"
    alias: "Telegram Bot Hallway Menu"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/hallway_control"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.delete_message
        data:
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
      - service: script.send_hallway_status
        data:
          target: "{{ trigger.event.data.chat_id }}"

  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω—é "–°–∏—Å—Ç–µ–º–∞"
  - id: "telegram_bot_system_control"
    alias: "Telegram Bot System Control"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/system_control"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.delete_message
        data:
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
      - service: script.send_system_status
        data:
          target: "{{ trigger.event.data.chat_id }}"

  ##############################################################################
  # –ì–æ—Å—Ç–∏–Ω–∞—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π toggle_device)
  ##############################################################################
  - id: "telegram_bot_toggle_livingroom_main_switch_left"
    alias: "Telegram Bot Toggle Livingroom Main Switch Left"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_livingroom_main_switch_left"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.livingroom_main_switch_left
          domain: light
          menu_script: script.send_livingroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_livingroom_main_switch_right"
    alias: "Telegram Bot Toggle Livingroom Main Switch Right"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_livingroom_main_switch_right"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.livingroom_main_switch_right
          domain: light
          menu_script: script.send_livingroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_livingroom_scone_dimmer"
    alias: "Telegram Bot Toggle Livingroom Scone Dimmer"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_livingroom_scone_dimmer"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.livingroom_scone_dimmer
          domain: light
          menu_script: script.send_livingroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  # –ì–æ—Å—Ç–∏–Ω–∞—è - —Ä–æ–∑–µ—Ç–∫–∏
  - id: "telegram_bot_toggle_livingroom_socket_corner_r"
    alias: "Telegram Bot Toggle Livingroom Socket Corner R"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_livingroom_socket_corner_r"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: switch.livingroom_socket_corner_r
          domain: switch
          menu_script: script.send_livingroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_livingroom_socket_l"
    alias: "Telegram Bot Toggle Livingroom Socket L"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_livingroom_socket_l"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: switch.livingroom_socket_l
          domain: switch
          menu_script: script.send_livingroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_livingroom_socket_r"
    alias: "Telegram Bot Toggle Livingroom Socket R"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_livingroom_socket_r"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: switch.livingroom_socket_r
          domain: switch
          menu_script: script.send_livingroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"
  # –ì–æ—Å—Ç–∏–Ω–∞—è - –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–µ—Ö–Ω–∏–∫–∞
  - id: "toggle_livingroom_humidifier"
    alias: "Telegram Bot Toggle Livingroom Humidifier"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_livingroom_humidifier"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: humidifier.xiaomi_cn_823407205_p3
          domain: humidifier
          menu_script: script.send_livingroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "toggle_livingroom_air_purifier"
    alias: "Telegram Bot Toggle Livingroom Air Purifier"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_livingroom_air_purifier"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: fan.zhimi_cn_271517251_mb3_s_2_air_purifier
          domain: fan
          menu_script: script.send_livingroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "toggle_livingroom_konditsioner"
    alias: "Telegram Bot Toggle Livingroom Konditsioner"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_livingroom_konditsioner"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: climate.konditsioner
          domain: climate
          menu_script: script.send_livingroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  ##############################################################################
  # –ö–∞–±–∏–Ω–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π toggle_device)
  ##############################################################################
  - id: "telegram_bot_toggle_workroom_light"
    alias: "Telegram Bot Toggle Workroom Light"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_workroom_light"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.workroom_switch
          domain: light
          menu_script: script.send_workroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_workroom_led"
    alias: "Telegram Bot Toggle Workroom LED"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_workroom_led"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.working_room_led
          domain: light
          menu_script: script.send_workroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_workroom_plug"
    alias: "Telegram Bot Toggle Workroom Plug"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_workroom_plug"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: switch.smart_plug_in_unit_vykliuchatel
          domain: switch
          menu_script: script.send_workroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  ##############################################################################
  # –°–ø–∞–ª—å–Ω—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π toggle_device)
  ##############################################################################
  - id: "telegram_bot_toggle_bedroom_light"
    alias: "Telegram Bot Toggle Bedroom Light"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_bedroom_light"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.bedroom_switch_main
          domain: light
          menu_script: script.send_bedroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_bedroom_scone_t"
    alias: "Telegram Bot Toggle Bedroom Tatiana's Scone"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_bedroom_scone_t"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.bedroom_left_switch_right
          domain: light
          menu_script: script.send_bedroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_bedroom_scone_a_small"
    alias: "Telegram Bot Toggle Bedroom Andrei's Scone Small"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_bedroom_scone_a_small"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.bedroom_right_switch_left
          domain: light
          menu_script: script.send_bedroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_bedroom_scone_a_big"
    alias: "Telegram Bot Toggle Bedroom Andrei's Scone Big"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_bedroom_scone_a_big"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.bedroom_right_switch_right
          domain: light
          menu_script: script.send_bedroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_bedroom_plug_left"
    alias: "Telegram Bot Toggle Bedroom Plug Left"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_bedroom_plug_left"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: switch.0x00158d0002530bd9
          domain: switch
          menu_script: script.send_bedroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_bedroom_plug_right"
    alias: "Telegram Bot Toggle Bedroom Plug Right"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_bedroom_plug_right"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: switch.0x00158d0002530ba3
          domain: switch
          menu_script: script.send_bedroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  ##############################################################################
  # –ö—É—Ö–Ω—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π toggle_device)
  ##############################################################################
  - id: "telegram_bot_toggle_kitchen_main_light"
    alias: "Telegram Bot Toggle Kitchen Main Light"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_kitchen_main_light"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.kitchen_main_light
          domain: light
          menu_script: script.send_kitchen_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_kitchen_fartuh"
    alias: "Telegram Bot Toggle Kitchen Fartuh"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_kitchen_fartuh"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: switch.kitchen_fartuh
          domain: switch
          menu_script: script.send_kitchen_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  ##############################################################################
  # –í–∞–Ω–Ω–∞—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π toggle_device)
  ##############################################################################
  - id: "telegram_bot_toggle_bathroom_light"
    alias: "Telegram Bot Toggle Bathroom Light"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_bathroom_light"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.light_bathroom
          domain: light
          menu_script: script.send_bathroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_bathroom_fan"
    alias: "Telegram Bot Toggle Bathroom Fan"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_bathroom_fan"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: fan.bathroom_relay_l1
          domain: fan
          menu_script: script.send_bathroom_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  ##############################################################################
  # –ü—Ä–∏—Ö–æ–∂–∞—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π toggle_device)
  ##############################################################################
  - id: "telegram_bot_toggle_hallway_light"
    alias: "Telegram Bot Toggle Hallway Light"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_hallway_light"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.hallway_switch
          domain: light
          menu_script: script.send_hallway_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_hallway_gateway_light"
    alias: "Telegram Bot Toggle Hallway Gateway Light"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_hallway_gateway_light"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.gateway_light_04cf8c977cdd
          domain: light
          menu_script: script.send_hallway_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  ##############################################################################
  # –°–∏—Å—Ç–µ–º–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π toggle_device)
  ##############################################################################
  - id: "telegram_bot_toggle_router_socket"
    alias: "Telegram Bot Toggle Router Socket"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_router_socket"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: switch.my_multi_outlet_left
          domain: switch
          menu_script: script.send_system_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_minipc_socket"
    alias: "Telegram Bot Toggle MiniPC Socket"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_minipc_socket"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: switch.my_multi_outlet_right
          domain: switch
          menu_script: script.send_system_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_bathroom_power"
    alias: "Telegram Bot Toggle Bathroom Power"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_bathroom_power"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: light.bathroom_main
          domain: light
          menu_script: script.send_system_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_silent_mode"
    alias: "Telegram Bot Toggle Silent Mode"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_silent_mode"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: input_boolean.silent_mode
          domain: input_boolean
          menu_script: script.send_system_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  - id: "telegram_bot_toggle_force_cctv_mode"
    alias: "Telegram Bot Toggle Force CCTV Off Mode"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/toggle_force_cctv_mode"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: script.toggle_device
        data:
          entity: input_boolean.force_camera_off
          domain: input_boolean
          menu_script: script.send_system_status
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
          user_id: "{{ trigger.event.data.user_id }}"

  # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã
  - id: "telegram_bot_confirm_reboot"
    alias: "Telegram Bot Confirm Reboot"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/confirm_reboot"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.send_message
        data:
          target: "{{ trigger.event.data.chat_id }}"
          parse_mode: html
          message: "<b>‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å–∏—Å—Ç–µ–º—ã!</b>"
          inline_keyboard: >
            {{ [
                [ ["‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å", "/force_reboot"] ],
                [ ["‚ùå –û—Ç–º–µ–Ω–∞", "/system_control"] ]
              ] | tojson }}
      - service: system_log.write
        data:
          message: "–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ reboot (user: {{ trigger.event.data.user_id }})"
          level: warning

  # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã (–ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
  - id: "telegram_bot_force_reboot"
    alias: "Telegram Bot Force Reboot"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/force_reboot"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.send_message
        data:
          target: "{{ trigger.event.data.chat_id }}"
          parse_mode: html
          message: "<b>‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥!</b>"
      - delay:
          seconds: 5
      - service: homeassistant.restart
      - service: system_log.write
        data:
          message: "–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ Telegram (user: {{ trigger.event.data.user_id }})"
          level: warning

  ##############################################################################
  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ Proxmox
  ##############################################################################
  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ PVE
  - id: "telegram_bot_pve_status_refresh"
    alias: "Telegram Bot PVE Status Refresh"
    initial_state: true
    triggers:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/pve_status_refresh"
    conditions:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - service: telegram_bot.delete_message
        data:
          message_id: "{{ trigger.event.data.message.message_id }}"
          chat_id: "{{ trigger.event.data.chat_id }}"
      - service: script.send_pve_status
        data:
          target: "{{ trigger.event.data.chat_id }}"

  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
  # === HAOS12 ===
  - id: "telegram_bot_reboot_haos12"
    alias: "Telegram Bot Reboot HAOS12"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/reboot_haos12"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.qemu_haos12_3_100_reboot
          chat_id: "{{ trigger.event.data.chat_id }}"

  # === MariaDB ===
  - id: "telegram_bot_start_mariadb"
    alias: "Telegram Bot Start LXC MariaDB"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/start_mariadb"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_mariadb_101_start
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_stop_mariadb"
    alias: "Telegram Bot Stop LXC MariaDB"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/stop_mariadb"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_mariadb_101_stop
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_reboot_mariadb"
    alias: "Telegram Bot Reboot LXC MariaDB"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/reboot_mariadb"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_mariadb_101_reboot
          chat_id: "{{ trigger.event.data.chat_id }}"

  # === Jackett ===
  - id: "telegram_bot_start_jackett"
    alias: "Telegram Bot Start LXC Jackett"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/start_jackett"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_jackett_102_start
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_stop_jackett"
    alias: "Telegram Bot Stop LXC Jackett"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/stop_jackett"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_jackett_102_stop
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_reboot_jackett"
    alias: "Telegram Bot Reboot LXC Jackett"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/reboot_jackett"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_jackett_102_reboot
          chat_id: "{{ trigger.event.data.chat_id }}"

  # === Jellyfin ===
  - id: "telegram_bot_start_jellyfin"
    alias: "Telegram Bot Start LXC Jellyfin"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/start_jellyfin"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_jellyfin_103_start
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_stop_jellyfin"
    alias: "Telegram Bot Stop LXC Jellyfin"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/stop_jellyfin"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_jellyfin_103_stop
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_reboot_jellyfin"
    alias: "Telegram Bot Reboot LXC Jellyfin"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/reboot_jellyfin"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_jellyfin_103_reboot
          chat_id: "{{ trigger.event.data.chat_id }}"

  # === Deluge ===
  - id: "telegram_bot_start_deluge"
    alias: "Telegram Bot Start LXC Deluge"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/start_deluge"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_deluge_104_start
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_stop_deluge"
    alias: "Telegram Bot Stop LXC Deluge"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/stop_deluge"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_deluge_104 # –∏–ª–∏ button.lxc_deluge_104_stop
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_reboot_deluge"
    alias: "Telegram Bot Reboot LXC Deluge"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/reboot_deluge"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_deluge_104_reboot
          chat_id: "{{ trigger.event.data.chat_id }}"

  # === TorrServer ===
  - id: "telegram_bot_start_torrserver"
    alias: "Telegram Bot Start LXC TorrServer"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/start_torrserver"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_debian_105_start
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_stop_torrserver"
    alias: "Telegram Bot Stop LXC TorrServer"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/stop_torrserver"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_debian_105_stop
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_reboot_torrserver"
    alias: "Telegram Bot Reboot LXC TorrServer"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/reboot_torrserver"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_debian_105_reboot
          chat_id: "{{ trigger.event.data.chat_id }}"

  # === MinimServer ===
  - id: "telegram_bot_start_minimserver"
    alias: "Telegram Bot Start LXC MinimServer"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/start_minimserver"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_minim_107_start
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_stop_minimserver"
    alias: "Telegram Bot Stop LXC MinimServer"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/stop_minimserver"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_minim_107_stop
          chat_id: "{{ trigger.event.data.chat_id }}"

  - id: "telegram_bot_reboot_minimserver"
    alias: "Telegram Bot Reboot LXC MinimServer"
    trigger:
      - platform: event
        event_type: telegram_callback
        event_data:
          data: "/reboot_minimserver"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    action:
      - service: script.pve_action
        data:
          button: button.lxc_minim_107_reboot
          chat_id: "{{ trigger.event.data.chat_id }}"
