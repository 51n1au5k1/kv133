################################################################################
# /packages/washing_machine.yaml
################################################################################
#
# –ü–∞–∫–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π Home Assistant –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–∞–±–æ—Ç—ã —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
# –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
#
# –ò–∑–º–µ–Ω–µ–Ω–∏—è/—É—Ç–æ—á–Ω–µ–Ω–∏—è:
#  - –£–±—Ä–∞–Ω—ã —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–æ input_boolean.washing_machine_finished (–æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ
#    binary_sensor.washing_machine_finished).
#  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Telegram + TTS –Ω–∞ –Ø–Ω–¥–µ–∫—Å-–∫–æ–ª–æ–Ω–∫—É.
#  - –°–±—Ä–æ—à–µ–Ω —Å–µ—Ä–≤–∏—Å notify.notify.
#
# –î–æ—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–∑—ã–≤–∞:
#  - –î–æ–±–∞–≤–ª–µ–Ω –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å –≤ binary_sensor (delay_off –¥–ª—è active, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è delay_on).
#  - –û–±—ä–µ–¥–∏–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞/–æ–∫–æ–Ω—á–∞–Ω–∏—è –∏ —Å–±—Ä–æ—Å–æ–≤ –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ.
#  - –£–ø—Ä–æ—â–µ–Ω—ã —É—Å–ª–æ–≤–∏—è –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö (–¥–æ–±–∞–≤–ª–µ–Ω silent_mode –≤ Telegram, –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ someone_is_home).
#  - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π.
#  - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —Å—Ç–∏—Ä–∫–∏ —É–º–µ–Ω—å—à–µ–Ω–æ –¥–æ 10 –º–∏–Ω –≤ —à–∞–±–ª–æ–Ω–µ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ).
#
################################################################################

input_number:
  wm_min_cycle_min:
    name: "–°—Ç–∏—Ä–∞–ª–∫–∞: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞ (–º–∏–Ω)"
    min: 5
    max: 180
    step: 5
    initial: 10

input_datetime:
  washing_machine_started_at:
    name: "–°—Ç–∏—Ä–∞–ª–∫–∞: –≤—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞ —Ü–∏–∫–ª–∞"
    has_date: true
    has_time: true

# –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ helper.yaml
# input_boolean:
#   washing_machine_running:
#     name: "–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç"
#     initial: off
#     icon: mdi:washing-machine
#
#   washing_machine_pre_restart_state:
#     name: "Washing Machine Pre-Restart State"
#     initial: off
#     icon: mdi:washing-machine

binary_sensor:
  - platform: template
    sensors:
      washing_machine_active:
        friendly_name: "–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞"
        availability_template: >
          {{ states('sensor.bathroom_washing_machine_power') not in ['unknown', 'unavailable', ''] }}
        value_template: >
          {{ (states('sensor.bathroom_washing_machine_power') | float(0)) > 5 }}
        delay_off:
          minutes: 1 # –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ø–∞–¥—ã –º–æ—â–Ω–æ—Å—Ç–∏

      washing_machine_finished:
        friendly_name: "–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞ —Å—Ç–∏—Ä–∫—É"
        availability_template: >
          {{ states('sensor.bathroom_washing_machine_power') not in ['unknown', 'unavailable', ''] }}
        value_template: >
          {{ (states('sensor.bathroom_washing_machine_power') | float(0)) < 5 }}
        delay_on:
          minutes: 2 # —É—Å—Ç–æ–π—á–∏–≤–æ <5 –í—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 2 –º–∏–Ω—É—Ç

automation:
  ##############################################################################
  # –°–û–•–†–ê–ù–ï–ù–ò–ï/–í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø –ü–†–ò SHUTDOWN/START HA
  ##############################################################################
  - id: "064cbd85-8d52-40ac-98bd-98164ad1434c"
    alias: "HELPER: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ HA"
    mode: single
    triggers:
      - trigger: homeassistant
        event: shutdown
        id: shutdown
      - trigger: homeassistant
        event: start
        id: start
    actions:
      - choose:
          # --- –í–ï–¢–ö–ê SHUTDOWN: –∑–∞–ø–æ–º–∏–Ω–∞–µ–º, —à–ª–∞ –ª–∏ —Å—Ç–∏—Ä–∫–∞ ---
          - conditions:
              - condition: trigger
                id: shutdown
            sequence:
              - choose:
                  - conditions:
                      - condition: state
                        entity_id: binary_sensor.washing_machine_active
                        state: "on"
                    sequence:
                      - action: input_boolean.turn_on
                        target:
                          entity_id: input_boolean.washing_machine_pre_restart_state
                default:
                  - action: input_boolean.turn_off
                    target:
                      entity_id: input_boolean.washing_machine_pre_restart_state

          # --- –í–ï–¢–ö–ê START: –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ---
          - conditions:
              - condition: trigger
                id: start
            sequence:
              - choose:
                  - conditions:
                      - condition: state
                        entity_id: input_boolean.washing_machine_pre_restart_state
                        state: "on"
                    sequence:
                      # –ï—Å–ª–∏ –¥–æ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ —Å—Ç–∏—Ä–∫–∞ —à–ª–∞ ‚Äî —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ —Ü–∏–∫–ª –∞–∫—Ç–∏–≤–µ–Ω
                      - action: input_boolean.turn_on
                        target:
                          entity_id:
                            - input_boolean.washing_machine_running
                            - input_boolean.wm_cycle_seen_start
                default:
                  # –ï—Å–ª–∏ —Ñ–ª–∞–≥ –Ω–µ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Äî –ø—Ä–æ—Å—Ç–æ —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ running=off
                  - action: input_boolean.turn_off
                    target:
                      entity_id: input_boolean.washing_machine_running

              # –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º pre_restart_state
              - action: input_boolean.turn_off
                target:
                  entity_id: input_boolean.washing_machine_pre_restart_state

  ##############################################################################
  # –°–¢–ê–¢–£–° –°–¢–ò–†–ö–ò: –°–¢–ê–†–¢/–û–ö–û–ù–ß–ê–ù–ò–ï
  ##############################################################################
  - id: "04a14878-99d3-4030-a17d-bfa3c75b1f9b"
    alias: "HELPER: –°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º (—Å—Ç–∞—Ä—Ç/–æ–∫–æ–Ω—á–∞–Ω–∏–µ)"
    mode: restart
    triggers:
      - trigger: numeric_state
        entity_id: sensor.bathroom_washing_machine_power
        above: 5
        id: start
      - trigger: numeric_state
        entity_id: sensor.bathroom_washing_machine_power
        below: 5
        for:
          minutes: 2
        id: finish
    conditions:
      - condition: template
        value_template: >
          {{ states('sensor.bathroom_washing_machine_power') not in ['unknown','unavailable'] }}
    actions:
      - choose:
          # --- START ---
          - conditions:
              - condition: trigger
                id: start
            sequence:
              - action: input_boolean.turn_on
                target:
                  entity_id:
                    - input_boolean.washing_machine_running
                    - input_boolean.wm_cycle_seen_start
              - action: input_datetime.set_datetime
                target:
                  entity_id: input_datetime.washing_machine_started_at
                data:
                  datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"

          # --- FINISH ---
          - conditions:
              - condition: trigger
                id: finish
              - condition: state
                entity_id: input_boolean.washing_machine_running
                state: "on"
              - condition: state
                entity_id: input_boolean.wm_cycle_seen_start
                state: "on"
              - condition: template
                value_template: >
                  {% set started = as_timestamp(states('input_datetime.washing_machine_started_at')) %}
                  {% set min_sec = (states('input_number.wm_min_cycle_min')|float(10)*60)|int %}
                  {{ started is number and (now().timestamp() - started) >= min_sec }}
            sequence:
              - action: input_boolean.turn_off
                target:
                  entity_id:
                    - input_boolean.washing_machine_running
                    - input_boolean.wm_cycle_seen_start

  ##############################################################################
  # –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û –ó–ê–í–ï–†–®–ï–ù–ò–ò –°–¢–ò–†–ö–ò (TTS + TELEGRAM)
  ##############################################################################
  - id: "d1e78a7d-56c3-4d4e-b2a4-8a23f1a62a45"
    alias: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: –°—Ç–∏—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (TTS + Telegram)"
    description: "–ü—Ä–∏ finished=on –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç TTS –∏ Telegram, –µ—Å–ª–∏ –Ω–µ startup/silent –∏ —Ü–∏–∫–ª –¥–ª–∏–ª—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ."
    mode: single
    triggers:
      - trigger: state
        entity_id: binary_sensor.washing_machine_finished
        to: "on"
        for:
          minutes: 2 # –¥–æ–ø. –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
    conditions:
      - condition: state
        entity_id: input_boolean.wm_cycle_seen_start
        state: "on"
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
      - condition: state
        entity_id: input_boolean.silent_mode
        state: "off"
      - condition: state
        entity_id: binary_sensor.someone_is_home_2
        state: "on"
      - condition: state
        entity_id: input_boolean.washing_machine_running
        state: "off"
      - condition: template
        value_template: >
          {% set started = as_timestamp(states('input_datetime.washing_machine_started_at')) %}
          {% set min_sec = (states('input_number.wm_min_cycle_min') | float(10) * 60) | int %}
          {{ started is number and (now().timestamp() - started) >= min_sec }}
    actions:
      - action: script.yandex_tts_washing_machine_finished
      - action: notify.send_message
        target:
          entity_id: notify.telegram_master
        data:
          message: "üè† –°—Ç–∏—Ä–∫–∞ –∑–∞–∫–æ–Ω—á–µ–Ω–∞! üßº"

  ##############################################################################
  # –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï –û –ó–ê–í–ï–†–®–ï–ù–ò–ò (–ï–°–õ–ò –ù–ï–¢ –î–í–ò–ñ–ï–ù–ò–Ø)
  ##############################################################################
  - id: "washing_machine_reminder_no_motion"
    alias: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Å—Ç–∏—Ä–∫–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è"
    description: "–ß–µ—Ä–µ–∑ 15 –º–∏–Ω –ø–æ—Å–ª–µ finished=on, –µ—Å–ª–∏ –Ω–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è –∏ –¥–≤–µ—Ä—å –∑–∞–∫—Ä—ã—Ç–∞ ‚Äî –Ω–∞–ø–æ–º–Ω–∏—Ç—å —á–µ—Ä–µ–∑ TTS."
    mode: single
    triggers:
      - trigger: state
        entity_id: binary_sensor.washing_machine_finished
        to: "on"
        for:
          minutes: 15
    conditions:
      - condition: state
        entity_id: input_boolean.wm_cycle_seen_start
        state: "on"
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
      - condition: state
        entity_id: input_boolean.silent_mode
        state: "off"
      - condition: state
        entity_id: binary_sensor.someone_is_home_2
        state: "on"
      - condition: state
        entity_id: binary_sensor.bathroom_motions
        state: "off"
      - condition: state
        entity_id: binary_sensor.bathroom_open_door
        state: "off"
    actions:
      - action: script.yandex_tts_washing_machine_reminder

  ##############################################################################
  # –ê–≤–∞—Ä–∏—è: —Ä–æ–∑–µ—Ç–∫–∞ —Å—Ç–∞–ª–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π –≤–æ –≤—Ä–µ–º—è —Å—Ç–∏—Ä–∫–∏
  ##############################################################################
  - id: "91f99b09-a228-43af-9377-11069bff484b"
    alias: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: –°—Ç–∏—Ä–∞–ª–∫–∞ ‚Äî —Ä–æ–∑–µ—Ç–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–∞–≤–∞—Ä–∏—è)"
    mode: single
    triggers:
      # —Ä–æ–∑–µ—Ç–∫–∞ —É—à–ª–∞ –≤ unavailable/unknown –∏ –¥–µ—Ä–∂–∏—Ç—Å—è —Ç–∞–∫ –º–∏–Ω–∏–º—É–º 30 —Å–µ–∫
      - trigger: state
        entity_id: switch.bathroom_washing_machine
        to: "unavailable"
        for: "00:00:30"
        id: unavailable
      - trigger: state
        entity_id: switch.bathroom_washing_machine
        to: "unknown"
        for: "00:00:30"
        id: unknown
    conditions:
      # —Å—Ç–∏—Ä–∫–∞ —à–ª–∞ –ø–æ –Ω–∞—à–µ–º—É —Ñ–ª–∞–≥—É
      - condition: state
        entity_id: input_boolean.washing_machine_running
        state: "on"
      # –Ω–µ –≤ —Ñ–∞–∑–µ —Å—Ç–∞—Ä—Ç–∞ —Å–∏—Å—Ç–µ–º—ã
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
      # —á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å, –µ—Å–ª–∏ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞ –∞–≤–∞—Ä–∏—è ‚Äî –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å
      - condition: state
        entity_id: input_boolean.wm_socket_outage_active
        state: "off"
    actions:
      - action: input_boolean.turn_on
        target:
          entity_id: input_boolean.wm_socket_outage_active
      - variables:
          started_at: "{{ states('input_datetime.washing_machine_started_at') }}"
          last_power: "{{ states('sensor.bathroom_washing_machine_power') }}"
          last_voltage: "{{ states('sensor.bathroom_washing_machine_voltage') }}"
          last_current: "{{ states('sensor.bathroom_washing_machine_current') }}"
      - action: notify.send_message
        target:
          entity_id: notify.telegram_master
        data:
          message: >-
            ‚ö†Ô∏è <b>–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞: –ø–∏—Ç–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</b>
            –†–æ–∑–µ—Ç–∫–∞ <code>switch.bathroom_washing_machine</code> –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –±–æ–ª–µ–µ 30 —Å.
            –°—Ç–∏—Ä–∫–∞ –Ω–∞—á–∞—Ç–∞: <b>{{ started_at }}</b>.
            –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è: P={{ last_power }} –í—Ç, U={{ last_voltage }} –í, I={{ last_current }} –ê.
            –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–∑–µ—Ç–∫—É/–≤–∏–ª–∫—É/–∞–≤—Ç–æ–º–∞—Ç.

      - action: script.yandex_tts_washing_machine_power_lost

  ##############################################################################
  # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: —Ä–æ–∑–µ—Ç–∫–∞ —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
  ##############################################################################
  - id: "eb7b1bfa-4c3d-4a78-ac5b-eaa20756842c"
    alias: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: –°—Ç–∏—Ä–∞–ª–∫–∞ ‚Äî –ø–∏—Ç–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"
    mode: single
    triggers:
      # —Ä–æ–∑–µ—Ç–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å –∏–∑ unavailable/unknown –≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –¥–µ—Ä–∂–∏—Ç—Å—è —Ç–∞–∫ 45 —Å–µ–∫
      - trigger: state
        entity_id: switch.bathroom_washing_machine
        from: "unavailable"
        for: "00:00:45"
      - trigger: state
        entity_id: switch.bathroom_washing_machine
        from: "unknown"
        for: "00:00:45"
    conditions:
      - condition: state
        entity_id: input_boolean.wm_socket_outage_active
        state: "on"
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
    actions:
      - action: input_boolean.turn_off
        target:
          entity_id: input_boolean.wm_socket_outage_active
      - variables:
          cur_power: "{{ states('sensor.bathroom_washing_machine_power') }}"
      - action: notify.send_message
        target:
          entity_id: notify.telegram_master
        data:
          message: >-
            ‚úÖ <b>–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞: –ø–∏—Ç–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</b>
            –†–æ–∑–µ—Ç–∫–∞ —Å–Ω–æ–≤–∞ –æ–Ω–ª–∞–π–Ω (—Å—Ç–∞–±–∏–ª—å–Ω–æ 45 —Å). –¢–µ–∫—É—â–∞—è –º–æ—â–Ω–æ—Å—Ç—å: {{ cur_power }} –í—Ç.
            –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å—Ç–∏—Ä–∫–∏.
      - action: script.yandex_tts_washing_machine_power_restored

  ##############################################################################
  # –ì–∏–≥–∏–µ–Ω–∞: —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –∞–≤–∞—Ä–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ HA
  ##############################################################################
  - id: "bc7cc8c2-b6c3-4843-851b-e69d25a9bc78"
    alias: "HELPER: –°–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –∞–≤–∞—Ä–∏–∏ —Å—Ç–∏—Ä–∞–ª–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ HA"
    mode: single
    triggers:
      - trigger: homeassistant
        event: start

    actions:
      # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –∞–≤–∞—Ä–∏–∏ —Ä–æ–∑–µ—Ç–∫–∏ —Å—Ç–∏—Ä–∞–ª–∫–∏
      - action: input_boolean.turn_off
        target:
          entity_id: input_boolean.wm_socket_outage_active
