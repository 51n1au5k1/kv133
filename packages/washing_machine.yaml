################################################################################
# /packages/washing_machine.yaml
################################################################################
#
# –ü–∞–∫–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π Home Assistant –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–∞–±–æ—Ç—ã —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
# –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
#
# –ò–∑–º–µ–Ω–µ–Ω–∏—è/—É—Ç–æ—á–Ω–µ–Ω–∏—è:
#  - –£–±—Ä–∞–Ω—ã —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–æ input_boolean.washing_machine_finished (–æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ
#    binary_sensor.washing_machine_finished).
#  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Telegram + TTS –Ω–∞ –Ø–Ω–¥–µ–∫—Å-–∫–æ–ª–æ–Ω–∫—É.
#  - –°–±—Ä–æ—à–µ–Ω —Å–µ—Ä–≤–∏—Å notify.notify.
#
################################################################################

input_boolean:
  washing_machine_running:
    name: "–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç"
    initial: off
    icon: mdi:washing-machine
  # --------------------------------------------------------------------------
  # Washing Machine Pre-State When Door Opened
  # --------------------------------------------------------------------------
  # –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç ¬´–∑–∞–ø–æ–º–Ω–∏—Ç—å¬ª, —á—Ç–æ –º–∞—à–∏–Ω–∞ –±—ã–ª–∞ –≤–∫–ª—é—á–µ–Ω–∞ –∏ —à—ë–ª —Ü–∏–∫–ª —Å—Ç–∏—Ä–∫–∏
  # –¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ (–∏–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ —Å—Ç–∏—Ä–∫–∞ —É–∂–µ –±—ã–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞).
  # --------------------------------------------------------------------------
  washing_machine_pre_restart_state:
    name: "Washing Machine Pre-Restart State"
    initial: off
    icon: mdi:washing-machine
binary_sensor:
  - platform: template
    sensors:
      washing_machine_active:
        friendly_name: "–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞"
        value_template: >-
          {{ states('sensor.bathroom_washing_machine_power') | float(default=0) > 5 }}
        # –ê–∫—Ç–∏–≤–Ω–∞, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –±–æ–ª–µ–µ 5 –í—Ç

      washing_machine_finished:
        friendly_name: "–°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞ —Å—Ç–∏—Ä–∫—É"
        value_template: >-
          {{ states('sensor.bathroom_washing_machine_power') | float(default=0) < 5 }}
        delay_on:
          minutes: 2
        # –ê–∫—Ç–∏–≤–Ω–∞, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –º–µ–Ω–µ–µ 5 –í—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 2 –º–∏–Ω—É—Ç –ø–æ–¥—Ä—è–¥

automation:
  ##############################################################################
  #
  #
  # 1) –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã HA
  #    - –ï—Å–ª–∏ binary_sensor.washing_machine_active == on, —Ç–æ –≤–∫–ª—é—á–∞–µ–º washing_machine_pre_restart_state.
  #      –ò–Ω–∞—á–µ –≤—ã–∫–ª—é—á–∞–µ–º.
  #
  # 2) –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ HA
  #    - –ï—Å–ª–∏ washing_machine_pre_restart_state == on, –∑–Ω–∞—á–∏—Ç
  #      —Å—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ ¬´—Ä–∞–±–æ—Ç–∞–ª–∞¬ª –¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏. –ú–æ–∂–Ω–æ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏
  #      –≤–∫–ª—é—á–∞—Ç—å –∫–∞–∫—É—é-—Ç–æ –ª–æ–≥–∏–∫—É (–Ω–æ –ø–æ—Å–∫–æ–ª—å–∫—É —Å–∞–º binary_sensor.washing_machine_active ‚Äî
  #      –æ–±—ã—á–Ω–æ ¬´—Ñ–∏–∑–∏—á–µ—Å–∫–∏–π¬ª –¥–∞—Ç—á–∏–∫ –∏–ª–∏ –ø—Ä–∏—Ö–æ–¥—è—â–∏–π —Å MQTT/ESPHome, –º—ã –Ω–µ –º–æ–∂–µ–º
  #      –ø—Ä—è–º–æ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏–µ).
  #    - –î–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ª–∏—à–Ω–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ ¬´–ó–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å—Ç–∏—Ä–∫–∏¬ª, –º—ã
  #      –≤—Ç–æ—Ä—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏) –≤—ã–∫–ª—é—á–∞–µ–º —Ñ–ª–∞–≥ input_boolean.washing_machine_pre_restart_state,
  #      —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å —Å–∏—Å—Ç–µ–º—É –≤ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
  #
  ##############################################################################
  # --------------------------------------------------------------------------
  # –°–û–•–†–ê–ù–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø –°–¢–ò–†–ê–õ–¨–ù–û–ô –ú–ê–®–ò–ù–´ –ü–†–ò –ó–ê–í–ï–†–®–ï–ù–ò–ò –†–ê–ë–û–¢–´ HA
  # --------------------------------------------------------------------------
  # –ï—Å–ª–∏ —Å—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –±—ã–ª–∞ ¬´–∞–∫—Ç–∏–≤–Ω–∞¬ª –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏, –∑–Ω–∞—á–∏—Ç —Ü–∏–∫–ª
  # —Å—Ç–∏—Ä–∫–∏ –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –¥–æ –∫–æ–Ω—Ü–∞. –ó–∞–ø–æ–º–Ω–∏–º —ç—Ç–æ.
  - id: "064cbd85-8d52-40ac-98bd-98164ad1434c"
    alias: "HELPER: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ HA"
    mode: single
    trigger:
      - platform: homeassistant
        event: shutdown
    action:
      - choose:
          - conditions:
              - condition: state
                entity_id: binary_sensor.washing_machine_active
                state: "on"
            sequence:
              - service: input_boolean.turn_on
                target:
                  entity_id: input_boolean.washing_machine_pre_restart_state
        default:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.washing_machine_pre_restart_state

  # --------------------------------------------------------------------------
  # –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø –°–¢–ò–†–ê–õ–¨–ù–û–ô –ú–ê–®–ò–ù–´ –ü–†–ò –°–¢–ê–†–¢–ï HA
  # --------------------------------------------------------------------------
  # –ï—Å–ª–∏ –ø—Ä–∏ –ø—Ä–æ—à–ª–æ–º –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ HA —Å—Ç–∏—Ä–∞–ª–∫–∞ —Ä–∞–±–æ—Ç–∞–ª–∞, —Ç–µ–∫—É—â–∏–π
  # sensor.washing_machine_active –º–æ–∂–µ—Ç –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –º–æ–º–µ–Ω—Ç –ø—Ä–∏–π—Ç–∏ –≤ ¬´off¬ª
  # (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–ø—Ä–æ—Å–∞). –ò–∑–±–µ–≥–∞–µ–º –ª–æ–∂–Ω–æ–≥–æ ¬´–∑–∞–≤–µ—Ä—à–µ–Ω–∏—è¬ª.
  # –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è,
  # –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —è–≤–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ¬´–º–∞—à–∏–Ω–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å—Ç–∏—Ä–∫–∏¬ª. –ù–æ –æ–±—ã—á–Ω–æ
  # —Å—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ —Å–∞–º–∞ ¬´—Å–æ–æ–±—â–∏—Ç¬ª –Ω–æ–≤—ã–π —Å—Ç–µ–π—Ç (on/off), –∫–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç —Å–≤—è–∑—å.
  #
  # –í –∫–æ–Ω—Ü–µ –≤—ã–∫–ª—é—á–∞–µ–º input_boolean.washing_machine_pre_restart_state, —á—Ç–æ–±—ã
  # –≤—Å—ë –≤–µ—Ä–Ω—É–ª–æ—Å—å –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
  - id: "a49b7efb-5294-4361-90f2-73943aa71194"
    alias: "HELPER: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ HA"
    mode: single
    trigger:
      - platform: homeassistant
        event: start
    action:
      # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∫–∞–∫—É—é-—Ç–æ –ª–æ–≥–∏–∫—É, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.
      - choose:
          - conditions:
              - condition: state
                entity_id: input_boolean.washing_machine_pre_restart_state
                state: "on"
            sequence:
              - service: system_log.write
                data:
                  message: "System start: —Å—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –±—ã–ª–∞ –∞–∫—Ç–∏–≤–Ω–∞ –¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏."
                  level: warning
        default: []
      # –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ –≥–∞—Å–∏–º –Ω–∞—à —Ñ–ª–∞–≥.
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.washing_machine_pre_restart_state

  ##############################################################################
  # –°–±—Ä–æ—Å –±–µ–≥—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ (washing_machine_running) –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã
  ##############################################################################
  - id: "055f9541-0e9f-40c3-b786-1cc9d17b15bb"
    alias: "HELPER: –°–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã"
    description: >
      –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ HA —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ washing_machine_running –≤ Off.
      (binary_sensor.washing_machine_finished –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ¬´—Å–∞–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—Å—è¬ª.)
    trigger:
      - platform: homeassistant
        event: start
    action:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.washing_machine_running

  ##############################################################################
  # –°–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å—Ç–∏—Ä–∫–∏
  ##############################################################################
  # –ï—Å–ª–∏ –º–æ—â–Ω–æ—Å—Ç—å —Å—Ç–∏—Ä–∞–ª–∫–∏ –ø–æ–¥–Ω—è–ª–∞—Å—å –≤—ã—à–µ 5 –í—Ç => —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å—Ç–∏—Ä–∫–∞.
  # –í–∫–ª—é—á–∞–µ–º washing_machine_running = on, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º ¬´–∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ—Å—Ç—å¬ª.
  #
  - id: "04a14878-99d3-4030-a17d-bfa3c75b1f9b"
    alias: "HELPER: –°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞: –°–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ"
    description: >
      –ö–æ–≥–¥–∞ –º–∞—à–∏–Ω–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å (–º–æ—â–Ω–æ—Å—Ç—å > 5), —Å—Ç–∞–≤–∏–º
      input_boolean.washing_machine_running=on.
    trigger:
      - platform: numeric_state
        entity_id: sensor.bathroom_washing_machine_power
        above: 5
    action:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.washing_machine_running

  ##############################################################################
  # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å—Ç–∏—Ä–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
  ##############################################################################
  # –ï—Å–ª–∏ –º–æ—â–Ω–æ—Å—Ç—å —É–ø–∞–ª–∞ –Ω–∏–∂–µ 5 –í—Ç –Ω–∞ 5 –º–∏–Ω—É—Ç -> —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ —Ü–∏–∫–ª –∑–∞–∫–æ–Ω—á–µ–Ω.
  # –û—Ç–∫–ª—é—á–∞–µ–º washing_machine_running (off).
  # (binary_sensor.washing_machine_finished –ø–µ—Ä–µ–π–¥—ë—Ç –≤ on —Å–∞–º –ø–æ —Å–µ–±–µ.)
  #
  - id: "2d3371e6-23df-4710-be67-c79088517d33"
    alias: "HELPER: –°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã"
    description: >
      –ï—Å–ª–∏ –º–æ—â–Ω–æ—Å—Ç—å < 5 –Ω–∞ 5 –º–∏–Ω—É—Ç –ø–æ–¥—Ä—è–¥, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —Å—Ç–∏—Ä–∫–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.
      –û—Ç–∫–ª—é—á–∞–µ–º washing_machine_running.
    trigger:
      - platform: numeric_state
        entity_id: sensor.bathroom_washing_machine_power
        below: 5
        for:
          minutes: 5
    condition:
      - condition: state
        entity_id: input_boolean.washing_machine_running
        state: "on"
    action:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.washing_machine_running

  ##############################################################################
  # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å—Ç–∏—Ä–∫–∏ (—á–µ—Ä–µ–∑ –¢–µ–ª–µ–≥—Ä–∞–º –∏ –Ø–Ω–¥–µ–∫—Å)
  ##############################################################################
  # –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ binary_sensor.washing_machine_finished –≤ on:
  #   - –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –≤ —Å—Ç–∞—Ä—Ç–µ (system_startup_phase=off)
  #   - —Ç–∏—Ö–∏–π —Ä–µ–∂–∏–º –≤—ã–∫–ª—é—á–µ–Ω (silent_mode=off)
  #   - —Å—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ (washing_machine_running=off) - —á—Ç–æ–±—ã –Ω–µ —É–≤–µ–¥–æ–º–ª—è—Ç—å,
  #     –µ—Å–ª–∏ –≤–¥—Ä—É–≥ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫.
  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –¢–µ–ª–µ–≥—Ä–∞–º + TTS-–Ω–∞–≥–∞–¥–∞–ª–∫—É –≤ –Ø–Ω–¥–µ–∫—Å-–∫–æ–ª–æ–Ω–∫—É.
  #
  - id: "d1e78a7d-56c3-4d4e-b2a4-8a23f1a62a45"
    alias: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. –Ø–Ω–¥–µ–∫—Å: –°—Ç–∏—Ä–∫–∞: –ó–∞–≤–µ—Ä—à–µ–Ω–∞"
    description: >
      –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å—Ç–∏—Ä–∫–∏ (binary_sensor.washing_machine_finished=on), 
      –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –¢–µ–ª–µ–≥—Ä–∞–º –∏ –≥–æ–≤–æ—Ä–∏–º –Ω–∞ –Ø–Ω–¥–µ–∫—Å-–∫–æ–ª–æ–Ω–∫–µ.
    trigger:
      - platform: state
        entity_id: binary_sensor.washing_machine_finished
        to: "on"
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
      - condition: state
        entity_id: input_boolean.silent_mode
        state: "off"
      - condition: state
        entity_id: input_boolean.washing_machine_running
        state: "off"
    action:
      # –û–∑–≤—É—á–∫–∞ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å-–∫–æ–ª–æ–Ω–∫—É (—Å–∫—Ä–∏–ø—Ç –≤—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ)
      - service: script.yandex_tts_washing_machine_finished
    mode: single

  ##############################################################################
  # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è 15 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  ##############################################################################
  # –ï—Å–ª–∏ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (washing_machine_finished=on) –≤ –≤–∞–Ω–Ω–æ–π
  # –Ω–µ –±—ã–ª–æ –¥–≤–∏–∂–µ–Ω–∏—è –∏ –¥–≤–µ—Ä—å –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–ª–∞—Å—å, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –µ—â—ë –æ–¥–Ω–æ
  # –≥–æ–ª–æ—Å–æ–≤–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ.
  #
  - id: "washing_machine_reminder_no_motion"
    alias: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. –Ø–Ω–¥–µ–∫—Å: –°—Ç–∏—Ä–∫–∞: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è"
    description: >
      –ß–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ binary_sensor.washing_machine_finished=on,
      –µ—Å–ª–∏ –Ω–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è –≤ –≤–∞–Ω–Ω–æ–π (binary_sensor.bathroom_motions=off)
      –∏ –¥–≤–µ—Ä—å –Ω–µ –æ—Ç–∫—Ä—ã—Ç–∞ (bathroom_open_door=off),
      –æ–∑–≤—É—á–∏–≤–∞–µ–º –¥—Ä—É–∂–µ—Å–∫–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç.
    trigger:
      - platform: state
        entity_id: binary_sensor.washing_machine_finished
        to: "on"
        for:
          minutes: 15
    condition:
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"
      - condition: state
        entity_id: input_boolean.silent_mode
        state: "off"
      - condition: state
        entity_id: binary_sensor.bathroom_motions
        state: "off"
      - condition: state
        entity_id: binary_sensor.bathroom_open_door
        state: "off"
    action:
      - service: script.yandex_tts_washing_machine_reminder
    mode: single

  # ----------------------------------------------------------------------------
  # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å—Ç–∏—Ä–∫–∏
  # ----------------------------------------------------------------------------
  # –¢—Ä–∏–≥–≥–µ—Ä ‚Äî –±–∏–Ω–∞—Ä–Ω—ã–π –¥–∞—Ç—á–∏–∫ (binary_sensor.washing_machine_finished).
  # –°–æ—Å—Ç–æ—è–Ω–∏–µ "on" –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç –∏ –ø—Ä–∏ —ç—Ç–æ–º sensor.washing_machine_active
  # == off, –ø–ª—é—Å –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —à—Ç–∞–º–ø–æ–≤–æ–º—É, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ª–æ–∂–Ω—ã—Ö
  # —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π. –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (master), —á—Ç–æ —Å—Ç–∏—Ä–∫–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.
  # ----------------------------------------------------------------------------
  # --------------------------------------------------------------------------
  # –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û –ó–ê–í–ï–†–®–ï–ù–ò–ò –°–¢–ò–†–ö–ò (–Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–æ –≤—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞)
  # --------------------------------------------------------------------------
  #      –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å—Ç–∏—Ä–∫–∏ (–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ)
  #    - –î–æ–±–∞–≤–∏–ª–∏ condition: system_startup_phase == off (—á—Ç–æ–±—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ).
  #    - –ï—â—ë –æ–¥–Ω–∞ condition: washing_machine_pre_restart_state == off, —á—Ç–æ–±—ã –µ—Å–ª–∏
  #      –º–∞—à–∏–Ω–∞ ¬´—è–∫–æ–±—ã¬ª –±—ã–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ø—Ä—è–º–æ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ ‚Äî –Ω–µ –≤—ã–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  #      –ø–æ–≤—Ç–æ—Ä–Ω–æ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ.
  # ----------------------------------------------------------------------------
  - id: "ba69e825-6c4e-4451-bb6f-cbbb224b1631"
    alias: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. –¢–µ–ª–µ–≥—Ä–∞–º: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å—Ç–∏—Ä–∫–∏"
    trigger:
      - platform: state
        entity_id: binary_sensor.washing_machine_finished
        to: "on"
        for:
          minutes: 5 # –∂–¥–µ–º 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ BINARY_SENSOR –ø–µ—Ä–µ—à–µ–ª –≤ on
    condition:
      # a) –ù–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤ —Ñ–∞–∑–µ –∑–∞–≥—Ä—É–∑–∫–∏
      - condition: state
        entity_id: input_boolean.system_startup_phase
        state: "off"

      # b) –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–∞—à–∏–Ω–∞ –Ω–µ –±—ã–ª–∞ ¬´—É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞¬ª –¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
      - condition: state
        entity_id: input_boolean.washing_machine_pre_restart_state
        state: "off"

      # c) –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–∞–º–∞ –º–∞—à–∏–Ω–∞ —É–∂–µ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞
      #    –ó–¥–µ—Å—å –º–µ–Ω—è–µ–º sensor.washing_machine_active ‚Üí binary_sensor.washing_machine_active
      - condition: state
        entity_id: binary_sensor.washing_machine_active
        state: "off"

      # d) –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å—Ç–∏—Ä–∞–ª–∫–∞ –±—ã–ª–∞ ¬´on¬ª –Ω–µ –º–µ–Ω–µ–µ 14 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥
      #    –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –º–µ–Ω—è–µ–º states.sensor.washing_machine_active ‚Üí states.binary_sensor.washing_machine_active
      - condition: template
        value_template: >
          {{ is_state('binary_sensor.washing_machine_active','on') and
            (as_timestamp(now()) -
              as_timestamp(states.binary_sensor.washing_machine_active.last_changed)) >= 840 }}
    action:
      - action: notify.master
        data:
          message: "üè† –°—Ç–∏—Ä–∫–∞ –∑–∞–∫–æ–Ω—á–µ–Ω–∞! üßº"
